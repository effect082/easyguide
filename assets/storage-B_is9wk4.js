import{c as n}from"./supabase-DxozfYyO.js";const c="https://bwffvmzxeyhftjtvkpmw.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ3ZmZ2bXp4ZXloZnRqdHZrcG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MjYyMTUsImV4cCI6MjA3OTQwMjIxNX0.uy-BDEiyaOortHwRXuPBM7RTxrfDmz7g0xQvWIMG_io";n(c,d);const l=void 0,p=void 0,f=`https://api.airtable.com/v0/${p}`,o=async(t,e="GET",s=null)=>{const a={method:e,headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}};s&&(a.body=JSON.stringify(s));const r=await fetch(`${f}/${t}`,a);if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(`Airtable Error (${r.status}): ${i.error?.message||r.statusText}`)}return r.json()},u={getProjects:async()=>{try{return(await o("Projects?sort%5B0%5D%5Bfield%5D=updatedAt&sort%5B0%5D%5Bdirection%5D=desc")).records.map(e=>({id:e.fields.id,_recordId:e.id,title:e.fields.title,category:e.fields.category,type:e.fields.type,password:e.fields.password,author:e.fields.author,blocks:e.fields.blocks?JSON.parse(e.fields.blocks):[],createdAt:e.fields.createdAt,updatedAt:e.fields.updatedAt}))}catch(t){throw console.error("Failed to fetch projects from Airtable:",t),t}},saveProject:async t=>{try{const s=(await o(`Projects?filterByFormula={id}='${t.id}'`)).records[0],a={id:t.id,title:t.title,category:t.category,type:t.type,password:t.password,author:t.author,blocks:JSON.stringify(t.blocks),updatedAt:new Date().toISOString()};if(s){const r=await o(`Projects/${s.id}`,"PATCH",{fields:a});return{...t,_recordId:r.id}}else{a.createdAt=new Date().toISOString();const r=await o("Projects","POST",{fields:a});return{...t,_recordId:r.id}}}catch(e){throw console.error("Failed to save project to Airtable:",e),e}},deleteProject:async t=>{try{const s=(await o(`Projects?filterByFormula={id}='${t}'`)).records[0];return s?(await o(`Projects/${s.id}`,"DELETE"),!0):(console.warn("Project not found for deletion"),!1)}catch(e){throw console.error("Failed to delete project from Airtable:",e),e}},getPublishedContent:async t=>{try{const s=(await o(`PublishedContents?filterByFormula={id}='${t}'`)).records[0];return s?{id:s.fields.id,projectId:s.fields.projectId,blocks:s.fields.blocks?JSON.parse(s.fields.blocks):[],metadata:s.fields.metadata?JSON.parse(s.fields.metadata):{},publishedAt:s.fields.publishedAt}:null}catch(e){return console.error("Failed to fetch published content from Airtable:",e),null}},publishContent:async(t,e)=>{try{const a=(await o(`PublishedContents?filterByFormula={id}='${t}'`)).records[0],r={id:t,projectId:e.projectId,blocks:JSON.stringify(e.blocks),metadata:JSON.stringify(e.metadata),publishedAt:e.publishedAt};return a?await o(`PublishedContents/${a.id}`,"PATCH",{fields:r}):await o("PublishedContents","POST",{fields:r}),e}catch(s){throw console.error("Failed to publish content to Airtable:",s),s}}},b=u;export{b as s};
