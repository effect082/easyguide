const f=async(a,o={})=>{const{maxWidth:e=800,maxHeight:t=800,quality:d=.7}=o;return new Promise((s,n)=>{const i=new FileReader;i.onload=m=>{const c=new Image;c.onload=()=>{let r=c.width,l=c.height;if(r>e||l>t){const h=Math.min(e/r,t/l);r=Math.floor(r*h),l=Math.floor(l*h)}const g=document.createElement("canvas");g.width=r,g.height=l;const p=g.getContext("2d");p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(c,0,0,r,l);const u=g.toDataURL("image/jpeg",d);g.toBlob(h=>{s({dataUrl:u,originalSize:a.size,compressedSize:h.size,reduction:Math.round((1-h.size/a.size)*100),width:r,height:l})},"image/jpeg",d)},c.onerror=()=>n(new Error("Failed to load image")),c.src=m.target.result},i.onerror=()=>n(new Error("Failed to read file")),i.readAsDataURL(a)})},y=a=>{if(a===0)return"0 B";const o=1024,e=["B","KB","MB","GB"],t=Math.floor(Math.log(a)/Math.log(o));return Math.round(a/Math.pow(o,t)*100)/100+" "+e[t]},w=async(a,o=320,e=.4)=>new Promise((t,d)=>{const s=new Image;s.onload=()=>{let n=s.width,i=s.height;if(n>o){const r=o/n;n=o,i=Math.floor(i*r)}const m=document.createElement("canvas");m.width=n,m.height=i,m.getContext("2d").drawImage(s,0,0,n,i),t(m.toDataURL("image/jpeg",e))},s.onerror=d,s.src=a}),M=async a=>{const o=JSON.parse(JSON.stringify(a));for(const e of o)if(e.type==="image"&&e.content?.src?.startsWith("data:image"))try{e.content.src=await w(e.content.src,320,.4)}catch(t){console.warn("Failed to compress image:",t)}else if(e.type==="gallery"&&e.content?.images)try{e.content.images=await Promise.all(e.content.images.map(async t=>t.startsWith("data:image")?await w(t,320,.4):t))}catch(t){console.warn("Failed to compress gallery images:",t)}else if(e.type==="slide"&&e.content?.images)try{e.content.images=await Promise.all(e.content.images.map(async t=>t.startsWith("data:image")?await w(t,320,.4):t))}catch(t){console.warn("Failed to compress slide images:",t)}else if(e.type==="share"&&e.content?.shareImage?.startsWith("data:image"))try{e.content.shareImage=await w(e.content.shareImage,320,.4)}catch(t){console.warn("Failed to compress share image:",t)}return o};export{f as a,M as c,y as f};
